
var myjob = function(args,next) {


    setTimeout(function() {


        if (args._jobId==10||args._jobId==20) {
            myQueueJobs.add(myjob,[999,'bla '+args._jobId]);
        }
        next();
    },Math.random(1000)*2000);
}

var myQueueJobs = new require('../qjobs')();

for (var i = 0; i<30; i++) {
    myQueueJobs.add(myjob,[i,'test1']);
}

myQueueJobs.on('start',function() {
    console.log('starting ...');
    console.log(JSON.stringify(myQueueJobs.stats()));
});

myQueueJobs.on('end',function() {
    clearInterval(statId);
    console.log('end');
    console.log(JSON.stringify(myQueueJobs.stats()));
});

myQueueJobs.on('jobStart',function(args) {
    console.log('jobStart',args);
});

myQueueJobs.on('jobEnd',function(args) {

    console.log('jobEnd',args);


    if (args._jobId == 10) {
        myQueueJobs.pause(true);
        setTimeout(function() {
            myQueueJobs.pause(false);
        },5000);
    }
});

myQueueJobs.on('pause',function(since) {
    console.log('in pause since '+since+' milliseconds');
});


myQueueJobs.run();

var statId = setInterval(function() {
    console.log(JSON.stringify(myQueueJobs.stats()));
},1000);
